<!doctype html>
<html>
<head>
  <title>Timeline</title>
  <link rel="stylesheet" href="tufte.css"/>
  <script type="text/javascript" src="https://unpkg.com/vis-timeline@latest/standalone/umd/vis-timeline-graph2d.min.js"></script>
  <link href="https://unpkg.com/vis-timeline@latest/styles/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />
  <style type="text/css">
    #visualization {
      width: 1200px;
      height: 600px;
      border: 1px solid lightgray;
    }
    .group-name-input {
      margin-bottom: 5px;
    }
  </style>
  <style>
    .vis-item {
      border-color: #AFBED1;
      background-color: #AFBED1;
    }
  </style>
</head>
<body>
  <h1>Timeline of People and Places</h1>
  <h4>Click on people to move around on the timeline.</h4>
   
<div id="visualization"></div>
<h4>Add a new person and their details here:</h4>
<div>
  <label for="itemName">Name:</label>
  <input type="text" id="itemName">
  <label for="startDate">Start Date:</label>
  <input type="date" id="startDate">
  <label for="endDate">End Date:</label>
  <input type="date" id="endDate">
  <label for="groupSelect">Group:</label>
  <select id="groupSelect">
    <!-- Group options will be added dynamically here -->
  </select>
  <button onclick="addTimelineItem()">Add Item</button>
</div>
<div id="groupNames">
  <h3>Group Names</h3>
  <h4>Change these names to your place names and they will be updated on the timeline</h4>
  <!-- Group names and input fields will be added dynamically here -->
</div>
<h4>To save your work as a JSON text file, click "Export Timeline". Or, "Import Timeline", to populate the above timeline with a saved timeline.</h4>
<button onclick="exportTimeline()">Export Timeline</button>
<input type="file" id="importFile" accept=".json" style="display:none">
<button onclick="document.getElementById('importFile').click()">Import Timeline</button>
<script type="text/javascript">
  var container = document.getElementById('visualization');
  var items = new vis.DataSet([
  { id: 1, content: "John", editable: true, start: "2024-05-24", end: "2024-05-27", group: 1 },
  { id: 2, content: "Brian", editable: true, start: "2024-05-24", end: "2024-05-27", group: 1 },
  { id: 3, content: "George", editable: true, start: "2024-05-24", end: "2024-05-30", group: 2 },
  { id: 4, content: "Ringo", editable: true, start: "2024-05-24", end: "2024-05-27", group: 3 },
  { id: 5, content: "Barbara", editable: true, start: "2024-05-24", end: "2024-05-27", group: 4},
  { id: 6, content: "Paul and Linda", editable: true, start: "2024-05-27", end: "2024-05-31", group: 3},
  { id: 7, content: "Peter", editable: true, start: "2024-05-28", end: "2024-05-30", group: 4 },
  { id: 8, content: "Peter and George", editable: true, start: "2024-06-3", group: 8},
  { id: 9, content: "John and George", editable: true, start: "2024-05-23", group: 8},
  { id: 10, content: "Peter", editable: true, start: "2024-06-6", group: 8},
  { id: 11, content: "George", editable: true, start: "2024-05-23", end: "2024-05-24", group: 8},
]);

var groups = [
  { id: 1, content: "Liverpool" },
  { id: 2, content: "Hamburg" },
  { id: 3, content: "London" },
  { id: 4, content: "Shea Stadium" },
  { id: 5, content: "Abbey Road" },
  { id: 6, content: "Downton Abbey" },
  { id: 8, content: "Scotland" },
  { id: 7, content: "Flights" },
];

var options = {
  editable: {
    add: true,
    remove: true,
    updateGroup: false,
    updateTime: true,
    overrideItems: false,
  }, // default for all items
};

var timeline = new vis.Timeline(container, items, groups, options);

// Add group name input fields dynamically
var groupNamesDiv = document.getElementById('groupNames');
groups.forEach(function(group) {
  var inputField = document.createElement('input');
  inputField.type = 'text';
  inputField.value = group.content;
  inputField.className = 'group-name-input';
  inputField.addEventListener('input', function() {
    updateGroupName(group.id, this.value);
  });
  groupNamesDiv.appendChild(inputField);
});

// Populate group options in select dropdown
var groupSelect = document.getElementById('groupSelect');
groups.forEach(function(group) {
  var option = document.createElement('option');
  option.value = group.id;
  option.textContent = group.content;
  groupSelect.appendChild(option);
});

function updateGroupName(groupId, newName) {
  var group = groups.find(function(group) {
    return group.id === groupId;
  });
  if (group) {
    group.content = newName;
    timeline.setGroups(groups);
  }
}

function addTimelineItem() {
  var itemName = document.getElementById('itemName').value.trim();
  var startDate = document.getElementById('startDate').value.trim();
  var endDate = document.getElementById('endDate').value.trim();
  var groupId = document.getElementById('groupSelect').value;

  // Validate input
  if (itemName === '' || startDate === '' || groupId === '') {
    alert('Please enter item name, start date, and select a group.');
    return;
  }

  var newItem = { id: items.length + 1, content: itemName, start: startDate, group: parseInt(groupId),style: "color: #292928; background-color: #AFBED1;" };
  if (endDate !== '') {
    newItem.end = endDate;
  }
  items.add(newItem);

  // Clear input fields
  document.getElementById('itemName').value = '';
  document.getElementById('startDate').value = '';
  document.getElementById('endDate').value = '';
}

function exportTimeline() {
  var exportedData = {
    items: items.get(),
    groups: groups
  };
  var blob = new Blob([JSON.stringify(exportedData)], { type: 'application/json' });
  var url = URL.createObjectURL(blob);
  var a = document.createElement('a');
  a.href = url;
  a.download = 'timeline.json';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

document.getElementById('importFile').addEventListener('change', function(event) {
  var file = event.target.files[0];
  if (file) {
    var reader = new FileReader();
    reader.onload = function(e) {
      try {
        var importedData = JSON.parse(e.target.result);
        items.clear();
        items.add(importedData.items);
        groups = importedData.groups;
        timeline.setGroups(groups);
        timeline.fit();
      } catch (error) {
        alert("Error importing timeline data. Please make sure the JSON format is correct.");
      }
    };
    reader.readAsText(file);
  }
});
  // Function to update group name
  function updateGroupName(groupId, newName) {
    var group = groups.find(function(group) {
      return group.id === groupId;
    });
    if (group) {
      group.content = newName;
      timeline.setGroups(groups);
      updateGroupSelectOptions(); // Update group select options
    }
  }

  // Function to update group select options
  function updateGroupSelectOptions() {
    // Clear existing options
    groupSelect.innerHTML = '';

    // Populate group options in select dropdown
    groups.forEach(function(group) {
      var option = document.createElement('option');
      option.value = group.id;
      option.textContent = group.content;
      groupSelect.appendChild(option);
    });
  }

  // Event listener for importing timeline data
  document.getElementById('importFile').addEventListener('change', function(event) {
    var file = event.target.files[0];
    if (file) {
      var reader = new FileReader();
      reader.onload = function(e) {
        try {
          var importedData = JSON.parse(e.target.result);
          items.clear();
          items.add(importedData.items);
          groups = importedData.groups;
          timeline.setGroups(groups);
          timeline.fit();
          updateGroupSelectOptions(); // Update group select options after importing
        } catch (error) {
          alert("Error importing timeline data. Please make sure the JSON format is correct.");
        }
      };
      reader.readAsText(file);
    }
  });

</script>
</body>
</html>
